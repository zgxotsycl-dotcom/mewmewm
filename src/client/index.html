<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mewdle.com</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: radial-gradient(1100px 720px at 30% 15%, #1b2444 0%, #0d0f14 55%, #07080c 100%);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo",
          "Noto Sans KR", "Malgun Gothic", sans-serif;
        user-select: none;
      }

      canvas {
        display: block;
        width: 100vw;
        height: 100vh;
        touch-action: none;
        -webkit-tap-highlight-color: transparent;
      }

      #ui {
        position: fixed;
        inset: 0;
        pointer-events: none;
      }

      #ui::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(closest-side at 50% 45%, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.35) 100%);
        pointer-events: none;
      }

      #ui::after {
        content: "";
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.55);
        opacity: 0;
        transition: opacity 120ms ease, background 200ms ease;
        pointer-events: none;
      }

      #ui.gas::after {
        opacity: 1;
      }

      /* Death transition: keep the world running behind, but fade the UI back to the menu. */
      #ui.deathfade::after {
        opacity: 1;
        background: rgba(0, 0, 0, 0.72);
        transition: opacity 650ms ease, background 650ms ease;
      }

      .panel {
        pointer-events: auto;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        width: min(420px, calc(100vw - 32px));
        padding: 18px 16px;
        border-radius: 14px;
        background: rgba(10, 12, 18, 0.78);
        border: 1px solid rgba(255, 255, 255, 0.12);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.45);
        backdrop-filter: blur(10px);
        color: #eaf0ff;
        transition: opacity 180ms ease, transform 220ms ease, filter 220ms ease;
      }

      .panel h1 {
        margin: 0 0 10px 0;
        font-size: 30px;
        letter-spacing: -0.02em;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
      }

      .brand > div:last-child {
        min-width: 0;
      }

      .brand-title {
        margin: 0;
        font-size: 30px;
        letter-spacing: -0.02em;
        line-height: 1.05;
      }

      .brand-title .shine {
        display: inline-block;
        background: linear-gradient(90deg, #eaf0ff 0%, #9fbaff 28%, #ffffff 50%, #9fbaff 72%, #eaf0ff 100%);
        background-size: 220% 100%;
        color: transparent;
        -webkit-background-clip: text;
        background-clip: text;
        filter: drop-shadow(0 14px 24px rgba(0, 0, 0, 0.35));
        animation: brand-shimmer 2.2s ease-in-out infinite, brand-float 3.4s ease-in-out infinite;
        will-change: background-position, transform;
      }

      @keyframes brand-shimmer {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      @keyframes brand-float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-1.5px);
        }
      }

      .brand-worm {
        position: relative;
        width: 96px;
        height: 34px;
        flex: 0 0 auto;
        animation: worm-float 2.8s ease-in-out infinite;
        filter: drop-shadow(0 10px 18px rgba(0, 0, 0, 0.35));
      }

      .brand-worm .seg {
        position: absolute;
        top: 50%;
        left: calc(var(--i) * 7px);
        --size: calc(18px - var(--i) * 0.55px);
        width: var(--size);
        height: var(--size);
        border-radius: 999px;
        background: radial-gradient(circle at 32% 30%, rgba(255, 255, 255, 0.62), rgba(255, 255, 255, 0) 52%),
          linear-gradient(90deg, rgba(120, 150, 255, 0.95), rgba(76, 92, 255, 0.95));
        box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.16) inset, 0 12px 16px rgba(0, 0, 0, 0.32);
        transform: translateY(-50%);
        animation: worm-wiggle 1.15s ease-in-out infinite;
        animation-delay: calc(var(--i) * -0.08s);
        will-change: transform;
        opacity: 0.92;
      }

      .brand-worm .seg.head {
        --size: 20px;
        left: calc(var(--i) * 7px);
        background: radial-gradient(circle at 35% 30%, rgba(255, 255, 255, 0.78), rgba(255, 255, 255, 0) 56%),
          linear-gradient(90deg, rgba(150, 195, 255, 0.98), rgba(88, 110, 255, 0.98));
        box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.18) inset, 0 14px 18px rgba(0, 0, 0, 0.36);
        opacity: 0.98;
      }

      .brand-worm .seg.head::before,
      .brand-worm .seg.head::after {
        content: "";
        position: absolute;
        top: 34%;
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.92);
        box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.26);
      }

      .brand-worm .seg.head::before {
        left: 32%;
      }

      .brand-worm .seg.head::after {
        left: 60%;
      }

      @keyframes worm-wiggle {
        0%,
        100% {
          transform: translateY(-50%) translateY(-2px) scale(0.985);
        }
        50% {
          transform: translateY(-50%) translateY(2px) scale(1.02);
        }
      }

      @keyframes worm-float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-2px);
        }
      }

      .row {
        display: flex;
        gap: 10px;
        margin-top: 12px;
      }

      input[type="text"] {
        flex: 1;
        padding: 12px 12px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.06);
        color: #eaf0ff;
        outline: none;
      }

      select {
        flex: 1;
        padding: 12px 12px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.06);
        color: #eaf0ff;
        outline: none;
      }

      .class-panel {
        margin-top: 10px;
        padding: 12px;
        border-radius: 14px;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .class-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }

      .icon-btn {
        width: 44px;
        height: 44px;
        border-radius: 12px;
        display: grid;
        place-items: center;
        background: rgba(120, 150, 255, 0.16);
        border: 1px solid rgba(255, 255, 255, 0.14);
        cursor: pointer;
        pointer-events: auto;
      }

      .icon-btn:hover {
        background: rgba(120, 150, 255, 0.22);
      }

      .class-meta {
        min-width: 0;
        flex: 1;
      }

      .class-name {
        font-weight: 900;
        letter-spacing: -0.02em;
        margin: 0;
        font-size: 18px;
      }

      .class-desc {
        margin-top: 4px;
        font-size: 12px;
        line-height: 1.35;
        color: rgba(234, 240, 255, 0.78);
      }

      .class-grid {
        display: grid;
        grid-template-columns: 1fr 180px;
        gap: 10px;
        align-items: center;
        margin-top: 10px;
      }

      .class-grid canvas {
        width: 180px;
        height: 180px;
        border-radius: 12px;
        background: rgba(0, 0, 0, 0.18);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .recommend {
        margin-top: 8px;
        font-size: 12px;
        color: rgba(234, 240, 255, 0.82);
      }

      .evohud {
        position: absolute;
        top: 12px;
        left: 50%;
        transform: translateX(-50%);
        pointer-events: none;
        width: min(420px, calc(100vw - 40px));
      }

      .evohud .bar {
        height: 10px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.1);
        overflow: hidden;
      }

      .evohud .bar > div {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, rgba(255, 210, 80, 0.95), rgba(255, 155, 60, 0.95));
        box-shadow: 0 0 18px rgba(255, 200, 90, 0.28);
        transition: width 160ms ease;
      }

      .evohud .text {
        margin-top: 6px;
        font-size: 12px;
        text-align: center;
        color: rgba(234, 240, 255, 0.82);
        text-shadow: 0 6px 18px rgba(0, 0, 0, 0.35);
      }

      .sixth-sense {
        position: absolute;
        inset: 0;
        pointer-events: none;
      }

      .sixth-sense .ping {
        position: absolute;
        left: 0;
        top: 0;
        width: 42px;
        height: 42px;
        border-radius: 999px;
        transform: translate(-50%, -50%);
        display: grid;
        place-items: center;
        font-weight: 900;
        font-size: 18px;
        color: rgba(255, 255, 255, 0.96);
        text-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        background: radial-gradient(circle at 35% 30%, rgba(255, 255, 255, 0.38), rgba(255, 255, 255, 0) 56%),
          linear-gradient(180deg, rgba(255, 220, 110, 0.96), rgba(255, 80, 90, 0.96));
        border: 1px solid rgba(255, 255, 255, 0.18);
        box-shadow: 0 16px 34px rgba(0, 0, 0, 0.45);
        opacity: var(--a, 0.9);
      }

      .sixth-sense .ping::after {
        content: "";
        position: absolute;
        inset: -8px;
        border-radius: 999px;
        border: 2px solid rgba(255, 210, 80, 0.35);
        opacity: 0;
        transform: scale(0.82);
        animation: ss-pulse 0.9s ease-out infinite;
        animation-delay: calc(var(--i, 0) * -0.12s);
      }

      @keyframes ss-pulse {
        0% {
          opacity: 0.55;
          transform: scale(0.78);
        }
        100% {
          opacity: 0;
          transform: scale(1.24);
        }
      }

      .skill-btn {
        --accent: rgba(255, 210, 80, 0.9);
        --accent-soft: rgba(255, 210, 80, 0.12);
        --accent-border: rgba(255, 210, 80, 0.25);
        position: absolute;
        right: 16px;
        bottom: 16px;
        width: 62px;
        height: 62px;
        border-radius: 18px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(10, 12, 18, 0.58);
        color: rgba(234, 240, 255, 0.9);
        pointer-events: auto;
        cursor: pointer;
        display: grid;
        place-items: center;
        box-shadow: 0 12px 26px rgba(0, 0, 0, 0.4);
        user-select: none;
        transition: transform 120ms ease, border-color 120ms ease, background 120ms ease, box-shadow 120ms ease;
        will-change: transform;
      }

      .skill-btn[data-usable="true"] {
        background: var(--accent-soft);
        border-color: var(--accent-border);
        box-shadow: 0 14px 32px rgba(0, 0, 0, 0.42), 0 0 0 1px rgba(255, 255, 255, 0.06) inset;
      }

      .skill-btn.ready-pop {
        animation: skill-ready-pop 260ms cubic-bezier(0.2, 0.9, 0.25, 1);
      }

      @keyframes skill-ready-pop {
        0% {
          transform: scale(1);
          box-shadow: 0 12px 26px rgba(0, 0, 0, 0.4);
        }
        50% {
          transform: scale(1.1);
          box-shadow: 0 18px 38px rgba(0, 0, 0, 0.5), 0 0 0 3px rgba(255, 255, 255, 0.06) inset, 0 0 22px
            var(--accent);
        }
        100% {
          transform: scale(1);
          box-shadow: 0 12px 26px rgba(0, 0, 0, 0.4);
        }
      }

      .skill-btn .k {
        font-weight: 900;
        font-size: 14px;
        opacity: 0.9;
      }

      .skill-btn .cd {
        position: absolute;
        inset: 0;
        border-radius: 18px;
        background: conic-gradient(var(--accent) var(--p), rgba(255, 255, 255, 0.06) 0);
        mask: radial-gradient(circle at 50% 50%, transparent 56%, #000 58%);
        opacity: 0.65;
        pointer-events: none;
      }

      .mutation-overlay {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 16px;
        background: rgba(0, 0, 0, 0.55);
        backdrop-filter: blur(10px);
        pointer-events: auto;
      }

      .mutation-modal {
        width: min(860px, 100%);
        border-radius: 18px;
        padding: 14px;
        background: rgba(10, 12, 18, 0.82);
        border: 1px solid rgba(255, 255, 255, 0.12);
        box-shadow: 0 18px 42px rgba(0, 0, 0, 0.5);
      }

      .mutation-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 10px;
        margin-bottom: 10px;
      }

      .mutation-title {
        font-weight: 900;
        letter-spacing: -0.02em;
      }

      .mutation-cards {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 12px;
      }

      .mutation-card {
        text-align: left;
        border-radius: 16px;
        padding: 14px 14px 16px 14px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(255, 255, 255, 0.04);
        cursor: pointer;
        color: rgba(234, 240, 255, 0.92);
        transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
      }

      .mutation-card:hover {
        transform: translateY(-2px);
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(255, 210, 80, 0.22);
      }

      .mutation-card .rarity {
        font-size: 11px;
        opacity: 0.75;
        margin-bottom: 6px;
      }

      .mutation-card .name {
        font-weight: 900;
        letter-spacing: -0.02em;
        margin-bottom: 6px;
      }

      .mutation-card .desc {
        font-size: 12px;
        line-height: 1.35;
        opacity: 0.8;
      }

      button {
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(120, 150, 255, 0.2);
        color: #eaf0ff;
        cursor: pointer;
      }

      button:hover {
        background: rgba(120, 150, 255, 0.28);
      }

      .hint {
        margin-top: 12px;
        line-height: 1.35;
        color: rgba(234, 240, 255, 0.78);
        font-size: 13px;
      }

      .hud {
        position: absolute;
        top: 12px;
        right: 12px;
        left: 12px;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
        pointer-events: none;
        transition: opacity 180ms ease, transform 220ms ease;
      }

      .stack {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .hud .box {
        pointer-events: auto;
        border-radius: 14px;
        padding: 10px 12px;
        background: rgba(10, 12, 18, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: rgba(234, 240, 255, 0.9);
        min-width: 180px;
      }

      .minimap {
        min-width: 180px;
      }

      .minimap canvas {
        display: block;
        width: 100%;
        height: auto;
        margin-top: 8px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }

      .box .title {
        font-weight: 700;
        margin-bottom: 6px;
        letter-spacing: 0.02em;
      }

      #leaderboard .entry {
        display: flex;
        justify-content: space-between;
        gap: 8px;
        font-size: 13px;
        padding: 3px 0;
      }

      #leaderboard .me {
        color: #ffffff;
        font-weight: 700;
      }

      .hidden {
        opacity: 0;
        pointer-events: none;
      }

      .panel.hidden {
        transform: translate(-50%, -50%) scale(0.96);
        filter: blur(2px);
      }

      .hud.hidden {
        transform: translateY(-6px);
      }
    </style>
  </head>
  <body>
      <div id="ui">
      <div id="menu" class="panel">
        <div class="brand">
          <div class="brand-worm" aria-hidden="true">
            <span class="seg" style="--i: 0"></span>
            <span class="seg" style="--i: 1"></span>
            <span class="seg" style="--i: 2"></span>
            <span class="seg" style="--i: 3"></span>
            <span class="seg" style="--i: 4"></span>
            <span class="seg" style="--i: 5"></span>
            <span class="seg" style="--i: 6"></span>
            <span class="seg" style="--i: 7"></span>
            <span class="seg" style="--i: 8"></span>
            <span class="seg" style="--i: 9"></span>
            <span class="seg" style="--i: 10"></span>
            <span class="seg head" style="--i: 11"></span>
          </div>
          <div>
            <h1 class="brand-title"><span class="shine">mewdle.com</span></h1>
          </div>
        </div>
        <div class="class-panel" id="classPanel">
          <div class="class-row" id="classSwipeArea">
            <button id="classPrev" class="icon-btn" type="button" aria-label="Previous class">◀</button>
            <div class="class-meta">
              <div id="className" class="class-name"></div>
              <div id="classDesc" class="class-desc"></div>
            </div>
            <button id="classNext" class="icon-btn" type="button" aria-label="Next class">▶</button>
          </div>
          <div class="class-grid">
            <div>
              <div id="classRecommend" class="recommend"></div>
            </div>
            <canvas id="classRadar" width="180" height="180"></canvas>
          </div>
          <select id="classSelect" aria-label="Class" style="display: none">
            <option value="iron">Iron Worm</option>
            <option value="shadow" selected>Shadow Snake</option>
            <option value="magnetic">Magnetic Slug</option>
          </select>
        </div>
        <div class="row">
          <input id="nameInput" type="text" maxlength="16" placeholder="Nickname" />
          <button id="playBtn">PLAY</button>
        </div>
      </div>

      <div id="hud" class="hud hidden">
        <div class="stack">
          <div id="stats" class="box"></div>
          <div id="minimapBox" class="box minimap">
            <div class="title">MAP</div>
            <canvas id="minimap" width="180" height="180"></canvas>
          </div>
        </div>
        <div id="leaderboard" class="box"></div>
      </div>

      <div id="death" class="panel hidden">
        <h1 style="margin-bottom: 8px">터졌습니다</h1>
        <div id="deathText" style="opacity: 0.9"></div>
        <div class="row">
          <button id="respawnBtn" style="flex: 1">다시하기</button>
        </div>
      </div>

      <div id="evoHud" class="evohud hidden" aria-hidden="true">
        <div class="bar"><div id="evoFill"></div></div>
        <div id="evoText" class="text"></div>
      </div>

      <div id="sixthSense" class="sixth-sense hidden" aria-hidden="true"></div>

      <button id="skillBtn" class="skill-btn hidden" type="button" aria-label="Active skill">
        <div class="cd"></div>
        <div class="k">E</div>
      </button>

      <div id="mutationOverlay" class="mutation-overlay hidden">
        <div class="mutation-modal">
          <div class="mutation-header">
            <div class="mutation-title">Mutation</div>
            <div id="mutationStage" style="opacity: 0.72; font-size: 12px"></div>
          </div>
          <div id="mutationCards" class="mutation-cards"></div>
          <div style="margin-top: 10px; font-size: 12px; opacity: 0.72; text-align: center">
            Tap a card (or press 1/2/3)
          </div>
        </div>
      </div>
    </div>
    <script type="module" src="./client.ts"></script>
  </body>
</html>
